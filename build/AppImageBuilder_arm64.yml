version: 1
script:
#  - which mksquashfs || apt install squashfs-tools
  - rm -rf AppDir | true
  - rm -rf appimage-build | true
  - mkdir -p AppDir/usr/src
  - cp main.py AppDir/usr/src
  - mkdir -p AppDir/usr/share/icons
  - cp build/bambino.png AppDir/usr/share/icons
  - python3.10 -m pip install --ignore-installed --prefix=/usr --root=AppDir -r requirements.txt

AppDir:
  path: ./AppDir
  app_info:
    id: LiveRecorder
    name: LiveRecorder
    icon: bambino
    version: Linux
    exec: usr/bin/python3.10
    exec_args: '$APPDIR/usr/src/main.py $@'

  apt:
    arch: arm64
    sources:
      - sourceline: 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports jammy main restricted universe multiverse'
        key_url: 'http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x871920d1991bc93c'
    include:
      - python3

  runtime:
    env:
      PYTHONHOME: '${APPDIR}/usr'
      PYTHONPATH: '${APPDIR}/usr/lib/python3.10/site-packages'

AppImage:
  arch: aarch64